#include <iostream>
#include <ctime>
#include <cstring>
#include <fstream>
#include <iomanip>
using namespace std;
int t = 0;
int c = 451;
struct student
{
    string name, cnic, program, phone;
    int roll;
    float cgpa;
};
void task1(/*Print all data*/)
{
    ifstream file("Student.txt");
    file.seekg(0, ios::end);
    int i = 0, size = 0;
    size = file.tellg();
    file.seekg(0, ios::beg);
    //cout << file.tellg();
    char* arr = new char[size];
    //arr[size] = { '\0' };
    while (file)
    {
        arr[i] = file.get();
        i++;
    }
    cout << arr;
    file.close();
    delete[] arr;
}
void task2(/*Searching with roll no*/)
{
    bool found = false;
    char temp[100];
    char name[20] = { '\0' }, cnic[20] = { '\0' }, prog[20] = { '\0' }, phone[20] = { '\0' }, roll[20] = { '\0' }, cgpa[20] = { '\0' }, check[20] = { '\0' };
    ifstream file("student.txt");
    file.getline(temp, 10000);
    unsigned int counter = 1;
    cout << "Enter desired rollno. : ";
    cin >> check;
    while (file)
    {
        int j = 0;
        file >> name >> cnic >> roll >> cgpa >> prog >> phone;
        j = strcmp(check, roll);
        if (j == 0)
        {
            found = true;
            cout << "Data found. " << endl;
            cout << "Name" << '\t' << "Cnic" << setw(20) << "rollno" << setw(10) << "cgpa" << '\t' << "program" << '\t' << "phone" << endl;
            cout << name << '\t' << cnic << '\t' << roll << setw(20) << cgpa << '\t' << prog << '\t' << phone;
            break;
        }
    }
    if (found == false)
    {
        cout << "Data not found." << endl;
    }
}
void task3(/*Showing topper's data*/)
{
    string line;
    int size = 0;
    ifstream file("Student.txt");
    file.seekg(0, ios::end);
    size = file.tellg();
    file.seekg(0, ios::beg);
    student* top = new student[size];
    char* temp = new char[size];
    file.getline(temp, size);
    for (int i = 0; i < size; i++)
    {
        file >> top[i].name >> top[i].cnic >> top[i].roll >> top[i].cgpa >> top[i].program >> top[i].phone;
    }
    int topper = top[0].cgpa;
    for (int i = 0; i < size; i++)
    {
        if (topper < top[i + 1].cgpa)
        {
            topper = top[i + 1].cgpa;
            t = i + 1;
        }
    }
    cout << "Topper is: " << endl << top[t].name << " " << top[t].cnic << " " << top[t].roll << " " << top[t].cgpa << " " << top[t].program << " " << top[t].phone;
    delete[] temp;
    delete[] top;
}

void task5(/*Appending and time stamping*/)
{

    int exit = 0;
    do
    {
        ofstream file("Student.txt", ios::app);
        cout << "Enter data: ";
        string name, cnic, roll, cgpa, program, phone;
        cin >> name >> cnic >> roll >> cgpa >> program >> phone;
        file << name << '\t' << cnic << '\t' << roll << '\t' << cgpa << '\t' << program << '\t' << phone << '\n';
        cout << "File written." << endl;
        file.close();
        time_t sec = time(0);
        ofstream put("Activity.txt", ios::app);
        put << "Append done at " << ctime(&sec) << " of " << name << '\t' << cnic << '\t' << roll << '\t' << cgpa << '\t' << program << '\t' << phone << '\n';
        cout << "Time data succesfully logged in the Activity file." << endl;
        put.close();
        cout << "To append again press 0 else press 1: " << endl;
        cin >> exit;
    } while (exit == 0);
}
void bonustask()
{
    char name[20], user[20], password[20], pass[20];
    ifstream reg("Registered.txt");
    while (reg)
    {
        reg >> name >> password;
    }
    cout << "Enter username: ";
    cin >> user;
    int check = strcmp(user, name);
    while (check != 0)
    {
    	check = strcmp(user, name);
        cout << "The username does not exist." << endl << "Enter correct username: " << endl;
        cin >> user;
    }
    do
    {
    	check = strcmp(pass, password);
        cout << "Enter password: ";
        cin >> pass;
    } while (check != 0);
    cout << "Access granted." << endl << "data in file is: " << endl;
    int i = 0, size = 0;
    reg.seekg(0, ios::end);
    size = reg.tellg();
    reg.seekg(0, ios::beg);
    char* arr = new char[size];
    while (reg)
    {
        arr[i] = reg.get();
        i++;
    }
    cout << arr;
    reg.close();
    time_t sec = time(0);
    ofstream put("Activity.txt", ios::app);
    put << "User " << user << " logged in Registrered file at: " << ctime(&sec) << endl;
}
int main()
{
    cout << "Enter task no: ";
    int j = 0;
    cin >> j;
    while (j > 6 || j < 0)
    {
        cout << "Please enter between 1 and 6 only." << endl;
        cin >> j;
    }
    cout << endl;
    if (j == 1)
    {
        task1();
    }
    else if (j == 2)
    {
        task2();
    }
    else if (j == 3)
    {
        task3();
    }
    else if (j == 4)
    {
        cout << "For sort W.R.T to rollno, name, cgpa press 1, 2, 3 respectively.";
        int choice = 0;
        cin >> choice;
        if (choice == 1)
        {

            ifstream file("Student.txt");
            student s;
            int size = 0, i = 0;
            string line;
            file.seekg(0, ios::end);
            size = file.tellg();
            file.seekg(0, ios::beg);
            student* st = new student[size];
            while (file)
            {
                file >> st[i].name >> st[i].cnic >> st[i].roll >> st[i].cgpa >> st[i].program >> st[i].phone;
                i++;
            }
            for (int i = 0; i < 451; i++)
            {
                for (int j = 0; j < 451 - i - 1; j++)
                {
                    if (st[j].roll > st[j + 1].roll)
                    {
                        student temp = st[j];
                        st[j] = st[j + 1];
                        st[j + 1] = temp;
                    }
                }
            }
            for (int i = 0; i < 451; i++)
            {
                cout << st[i].name << setw(10) << st[i].cnic << "\t" << st[i].roll << "\t" << st[i].cgpa << "\t" << st[i].program << "\t" << st[i].phone << endl;
            }
            //delete[] st;
        }

        else if (choice == 2)
        {

            ifstream file("Student.txt");
            student s;
            int size = 0, i = 0;
            string line;
            file.seekg(0, ios::end);
            size = file.tellg();
            file.seekg(0, ios::beg);
            student* st = new student[size];
            while (file)
            {
                file >> st[i].name >> st[i].cnic >> st[i].roll >> st[i].cgpa >> st[i].program >> st[i].phone;
                i++;
            }
            for (int i = 0; i < 451; i++)
            {
                for (int j = 0; j < 451 - i - 1; j++)
                {
                    if (st[j].name > st[j + 1].name)
                    {
                        student temp = st[j];
                        st[j] = st[j + 1];
                        st[j + 1] = temp;
                    }
                }
            }
            for (int i = 0; i < 451; i++)
            {
                cout << st[i].name << setw(10) << st[i].cnic << "\t" << st[i].roll << "\t" << st[i].cgpa << "\t" << st[i].program << "\t" << st[i].phone << endl;
            }
            //delete[] st;
        }

        else if (choice == 3)
        {

            ifstream file("Student.txt");
            student s;
            int size = 0, i = 0;
            string line;
            file.seekg(0, ios::end);
            size = file.tellg();
            file.seekg(0, ios::beg);
            student* st = new student[size];
            while (file)
            {
                file >> st[i].name >> st[i].cnic >> st[i].roll >> st[i].cgpa >> st[i].program >> st[i].phone;
                i++;
            }
            for (int i = 0; i < 451; i++)
            {
                for (int j = 0; j < 451 - i - 1; j++)
                {
                    if (st[j].cgpa > st[j + 1].cgpa)
                    {
                        student temp = st[j];
                        st[j] = st[j + 1];
                        st[j + 1] = temp;
                    }
                }
            }
            for (int i = 0; i < 451; i++)
            {
                cout << st[i].name << setw(10) << st[i].cnic << "\t" << st[i].roll << "\t" << st[i].cgpa << "\t" << st[i].program << "\t" << st[i].phone << endl;
            }
            //delete[] st;
        }
    }
        else if (j == 5)
        {
            task5();
        }
        else if (j == 6)
        {
            bonustask();
        }
}
